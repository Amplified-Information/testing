syntax = "proto3";

package clob;

service Clob {
  rpc PlaceOrder (OrderRequest) returns (OrderResponse);
  rpc GetBook (BookRequest) returns (BookSnapshot);
  rpc StreamBook (BookRequest) returns (stream BookSnapshot);
}

message OrderRequest {
  string owner = 1;
  string buy_sell = 2;
  double price = 3;
  double amount = 4;
  int64 timestamp_ns = 5; // Hedera nanoseconds since epoch
  string tx_hash = 6;
}

// message PredictionIntentRequest {
//   // Strict RFC-9562-compliant UUIDv7
//   string txid = 1                         [(validate.rules).string = {pattern: "(?i)^[0-9a-f]{8}-[0-9a-f]{4}-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
//   // Strict RFC-9562-compliant UUIDv7
//   string marketId = 2                     [(validate.rules).string = {pattern: "(?i)^[0-9a-f]{8}-[0-9a-f]{4}-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"}];
//   // UTC ISO 8601 (Zulu time only)
//   string utc = 3                          [(validate.rules).string = {pattern: "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])T([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d\\.\\d{3}Z$"}];
//   // Hedera account ID (no leading zeros)
//   string accountId = 4                    [(validate.rules).string = {pattern: "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)$"}];
//   // buy = "buy", sell = "sell"
//   string buySell = 5                      [(validate.rules).string = {in: ["buy", "sell"]}];
//   // still have 15 digits of decimal precision between 0.0 and 1.0
//   double priceUsd = 6                     [(validate.rules).double = {gt: 0.0, lt: 1.0}];
//   double nShares = 7                      [(validate.rules).double = {gt: 0.0}];
//   // base64-encoded signature (URL-safe base64 without padding, min 20 chars, max 100 chars)
//   string sig = 8                          [(validate.rules).string = {pattern: "^[A-Za-z0-9+/]{20,100}={0,2}$"}];
// }

message OrderResponse {
  string status = 1;
  string error = 2;
}

message BookRequest {
  uint32 depth = 1;
}

message BookSnapshot {
  repeated PriceLevel bids = 1;
  repeated PriceLevel asks = 2;
}

message PriceLevel {
  double price = 1;
  uint32 count = 2;
}
